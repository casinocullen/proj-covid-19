-- ==========================================================
-- GEOGRAPHIC ROLLUP
  -- TABLE: la_sd
  -- INPUT: la_base_blocks
-- ==========================================================

DROP TABLE IF exists sch_analysis.la_sd;
CREATE TABLE sch_analysis.la_counties_broadband AS 	
	SELECT 
		geoid_co,
		SUM(hu2010)   AS hu2010_sum,
		SUM(hu2011)   AS hu2011_sum,
		SUM(hu2012)   AS hu2012_sum,
		SUM(hu2013)   AS hu2013_sum,
		SUM(hu2014)   AS hu2014_sum,
		SUM(hu2015)   AS hu2015_sum,
		SUM(hu2016)   AS hu2016_sum,
		SUM(hu2017)   AS hu2017_sum,
		SUM(hu2018)   AS hu2018_sum,
		SUM(pop2010)  AS pop2010_sum,
		SUM(pop2011)  AS pop2011_sum,
		SUM(pop2012)  AS pop2012_sum,
		SUM(pop2013)  AS pop2013_sum,
		SUM(pop2014)  AS pop2014_sum,
		SUM(pop2015)  AS pop2015_sum,
		SUM(pop2016)  AS pop2016_sum,
		SUM(pop2017)  AS pop2017_sum,
		SUM(pop2018)  AS pop2018_sum,
		SUM(hh2010)   AS hh2010_sum,
		SUM(hh2011)   AS hh2011_sum,
		SUM(hh2012)   AS hh2012_sum,
		SUM(hh2013)   AS hh2013_sum,
		SUM(hh2014)   AS hh2014_sum,
		SUM(hh2015)   AS hh2015_sum,
		SUM(hh2016)   AS hh2016_sum,
		SUM(hh2017)   AS hh2017_sum,
		SUM(hh2018)   AS hh2018_sum,
		COUNT(DISTINCT geoid)    AS bl_count,
		COUNT(DISTINCT geoid_bg) AS bg_count,
		COUNT(DISTINCT geoid_co) AS co_count,
		COUNT(DISTINCT geoid_tr) AS tr_count,
		COUNT(DISTINCT geoid_cs) AS cs_count,
		COUNT(DISTINCT geoid_pl) AS pl_count,
		COUNT(DISTINCT geoid_zc) AS zc_count,
		COUNT(DISTINCT geoid_cd) AS cd_count,
		COUNT(DISTINCT geoid_cbsa_id) AS cbsa_count,

		--Count of blocks (rural/non-rural)
		/* CMSRHC */ COUNT(geoid) filter (WHERE rural_cmsrhc_flag = 1)   AS rural_cms_blcnt,
		/* EDA    */ COUNT(geoid) filter (WHERE rural_eda_flag = 1)   AS rural_eda_blcnt,
		/* LISC   */ COUNT(geoid) filter (WHERE rural_lisc = 'Rural LISC Service Area')   AS rural_lisc_blcnt,		
		/* FHFA   */ COUNT(geoid) filter (WHERE rural_fhfa_flag = 1)   AS rural_fhfa_blcnt,	
		/* FORHP  */ COUNT(geoid) filter (WHERE rural_forhp_flag = 1)   AS rural_forhp_blcnt,	
		/* FAR    */ COUNT(geoid) filter (WHERE rural_far_flag = 1)   AS rural_far_blcnt,	
		/* CBSA   */ COUNT(geoid) filter (WHERE rural_cbsa_flag = 1)   AS rural_cbsa_blcnt,
		/* MSA    */ COUNT(geoid) filter (WHERE rural_msa_flag  = 1)   AS rural_msa_blcnt,
		/* UC     */ COUNT(geoid) filter (WHERE rural_uc_flag = 1)   AS rural_uc_blcnt,
		/* RUCC   */ COUNT(geoid) filter (WHERE rural_rucc_flag = 1)   AS rural_rucc_blcnt,
		/* UIC    */ COUNT(geoid) filter (WHERE rural_uic_flag = 1)   AS rural_uic_blcnt,
		/* RUCA   */ COUNT(geoid) filter (WHERE rural_ruca_flag = 1)   AS rural_ruca_blcnt,
		/* USDA   */ COUNT(geoid) filter (WHERE rural_usda_flag = 1)   AS rural_usda_blcnt,
		/* UR10   */ COUNT(geoid) filter (WHERE rural_ur10_flag = 1)   AS rural_ur10_blcnt,

    --Sum of area (rural/non-rural)
    /* ALL    */ SUM(area_sqmi) AS total_area_sum,
    /* CMSRHC */ SUM(area_sqmi) filter (WHERE rural_cmsrhc_flag = 1)   AS rural_cms_area_sum,
                 SUM(area_sqmi) filter (WHERE rural_cmsrhc_flag = 0)   AS non_rural_cms_area_sum,
		/* EDA    */ SUM(area_sqmi) filter (WHERE rural_eda_flag = 1)   AS rural_eda_area_sum,
		             SUM(area_sqmi) filter (WHERE rural_eda_flag = 0)   AS non_rural_eda_area_sum,
		/* LISC   */ SUM(area_sqmi) filter (WHERE rural_lisc = 'Rural LISC Service Area')   AS rural_lisc_area_sum,
		             SUM(area_sqmi) filter (WHERE rural_lisc = 'Not Rural LISC Service Area')   AS non_rural_lisc_area_sum,
		/* FHFA   */ SUM(area_sqmi) filter (WHERE rural_fhfa_flag = 1)   AS rural_fhfa_area_sum,
		             SUM(area_sqmi) filter (WHERE rural_fhfa_flag = 0)   AS non_rural_fhfa_area_sum,
		/* FORHP  */ SUM(area_sqmi) filter (WHERE rural_forhp_flag = 1)   AS rural_forhp_area_sum,
		             SUM(area_sqmi) filter (WHERE rural_forhp_flag = 0)   AS non_rural_forhp_area_sum,
		/* FAR    */ SUM(area_sqmi) filter (WHERE rural_far_flag = 1)   AS rural_far_area_sum,
		             SUM(area_sqmi) filter (WHERE rural_far_flag = 0)   AS non_rural_far_area_sum,
		/* CBSA   */ SUM(area_sqmi) filter (WHERE rural_cbsa_flag = 1)   AS rural_cbsa_area_sum,
		             SUM(area_sqmi) filter (WHERE rural_cbsa_flag = 0)   AS non_rural_cbsa_area_sum,
		/* MSA    */ SUM(area_sqmi) filter (WHERE rural_msa_flag = 1)   AS rural_msa_area_sum,
		             SUM(area_sqmi) filter (WHERE rural_msa_flag = 0)   AS non_rural_msa_area_sum,
		/* UC     */ SUM(area_sqmi) filter (WHERE rural_uc_flag = 1)   AS rural_uc_area_sum,
		             SUM(area_sqmi) filter (WHERE rural_uc_flag = 0)   AS non_rural_uc_area_sum,
		/* RUCC   */ SUM(area_sqmi) filter (WHERE rural_rucc_flag = 1)   AS rural_rucc_area_sum,
		             SUM(area_sqmi) filter (WHERE rural_rucc_flag = 0)   AS non_rural_rucc_area_sum,
		/* UIC    */ SUM(area_sqmi) filter (WHERE rural_uic_flag = 1)   AS rural_uic_area_sum,
		             SUM(area_sqmi) filter (WHERE rural_uic_flag = 0)   AS non_rural_uic_area_sum,
		/* RUCA   */ SUM(area_sqmi) filter (WHERE rural_ruca_flag = 1)   AS rural_ruca_area_sum,
		             SUM(area_sqmi) filter (WHERE rural_ruca_flag = 0)   AS non_rural_ruca_area_sum,
		/* USDA   */ SUM(area_sqmi) filter (WHERE rural_usda_flag = 1)   AS rural_usda_area_sum,
		             SUM(area_sqmi) filter (WHERE rural_usda_flag = 0)   AS non_rural_usda_area_sum,
		/* UR10   */ SUM(area_sqmi) filter (WHERE rural_ur10_flag = 1)   AS rural_ur10_area_sum,
		             SUM(area_sqmi) filter (WHERE rural_ur10_flag = 0)   AS non_rural_ur10_area_sum,


    --Sum of population (rural/non-rural)
    /* CMSRHC */ SUM(pop2018) filter (WHERE rural_cmsrhc_flag = 1)   AS rural_cms_pop_sum,
                 SUM(pop2018) filter (WHERE rural_cmsrhc_flag = 0)   AS non_rural_cms_pop_sum,
		/* EDA    */ SUM(pop2018) filter (WHERE rural_eda_flag = 1)   AS rural_eda_pop_sum,
		             SUM(pop2018) filter (WHERE rural_eda_flag = 0)   AS non_rural_eda_pop_sum,
		/* LISC   */ SUM(pop2018) filter (WHERE rural_lisc = 'Rural LISC Service Area')   AS rural_lisc_pop_sum,
		             SUM(pop2018) filter (WHERE rural_lisc = 'Not Rural LISC Service Area')   AS non_rural_lisc_pop_sum,
		/* FHFA   */ SUM(pop2018) filter (WHERE rural_fhfa_flag = 1)   AS rural_fhfa_pop_sum,
		             SUM(pop2018) filter (WHERE rural_fhfa_flag = 0)   AS non_rural_fhfa_pop_sum,
		/* FORHP  */ SUM(pop2018) filter (WHERE rural_forhp_flag = 1)   AS rural_forhp_pop_sum,
		             SUM(pop2018) filter (WHERE rural_forhp_flag = 0)   AS non_rural_forhp_pop_sum,
		/* FAR    */ SUM(pop2018) filter (WHERE rural_far_flag = 1)   AS rural_far_pop_sum,
		             SUM(pop2018) filter (WHERE rural_far_flag = 0)   AS non_rural_far_pop_sum,
		/* CBSA   */ SUM(pop2018) filter (WHERE rural_cbsa_flag = 1)   AS rural_cbsa_pop_sum,
		             SUM(pop2018) filter (WHERE rural_cbsa_flag = 0)   AS non_rural_cbsa_pop_sum,
		/* MSA    */ SUM(pop2018) filter (WHERE rural_msa_flag = 1)   AS rural_msa_pop_sum,
		             SUM(pop2018) filter (WHERE rural_msa_flag = 0)   AS non_rural_msa_pop_sum,
		/* UC     */ SUM(pop2018) filter (WHERE rural_uc_flag = 1)   AS rural_uc_pop_sum,
		             SUM(pop2018) filter (WHERE rural_uc_flag = 0)   AS non_rural_uc_pop_sum,
		/* RUCC   */ SUM(pop2018) filter (WHERE rural_rucc_flag = 1)   AS rural_rucc_pop_sum,
		             SUM(pop2018) filter (WHERE rural_rucc_flag = 0)   AS non_rural_rucc_pop_sum,
		/* UIC    */ SUM(pop2018) filter (WHERE rural_uic_flag = 1)   AS rural_uic_pop_sum,
		             SUM(pop2018) filter (WHERE rural_uic_flag = 0)   AS non_rural_uic_pop_sum,
		/* RUCA   */ SUM(pop2018) filter (WHERE rural_ruca_flag = 1)   AS rural_ruca_pop_sum,
		             SUM(pop2018) filter (WHERE rural_ruca_flag = 0)   AS non_rural_ruca_pop_sum,
		/* USDA   */ SUM(pop2018) filter (WHERE rural_usda_flag = 1)   AS rural_usda_pop_sum,
		             SUM(pop2018) filter (WHERE rural_usda_flag = 0)   AS non_rural_usda_pop_sum,
		/* UR10   */ SUM(pop2018) filter (WHERE rural_ur10_flag = 1)   AS rural_ur10_pop_sum,
		             SUM(pop2018) filter (WHERE rural_ur10_flag = 0)   AS non_rural_ur10_pop_sum,

		-- NMTC / OZ Eligibility
		COUNT(geoid) filter (WHERE nmtc_eligibility = 'Yes')   AS nmtc_blcnt,
		COUNT(geoid) filter (WHERE oz_eligibility = 'Yes')     AS oz_blcnt,
	
		SUM(pop2018) filter (WHERE nmtc_eligibility = 'Yes')   AS nmtc_pop_sum,
		SUM(pop2018) filter (WHERE oz_eligibility = 'Yes')     AS oz_pop_sum,	
		
		COUNT(geoid)   filter (WHERE highed__record_count > 0)         AS highed__blcnt,
		COUNT(geoid)   filter (WHERE highed__lvl_4yr_equivalent > 0)   AS highed__lvl_4yr_equivalent_blcnt,
		COUNT(geoid)   filter (WHERE highed__lvl_2yr_equivalent > 0)   AS highed__lvl_2yr_equivalent_blcnt,
		COUNT(geoid)   filter (WHERE highed__lvl_less_than_2yr > 0)    AS highed__lvl_less_than_2yr_blcnt,
		COUNT(geoid)   filter (WHERE highed__lvl_4yr_500up > 0)        AS highed__lvl_4yr_500up_blcnt,
		COUNT(geoid)   filter (WHERE highed__lvl_4yr_1000up > 0)       AS highed__lvl_4yr_1000up_blcnt,
		COUNT(geoid)   filter (WHERE highed__lvl_4yr_2000up > 0)       AS highed__lvl_4yr_2000up_blcnt,
		COUNT(geoid)   filter (WHERE highed__lvl_4yr_5000up > 0)       AS highed__lvl_4yr_5000up_blcnt,
		
		

		SUM(area_sqmi) filter (WHERE highed__lvl_4yr_equivalent >=1)             AS highed__lvl_4yr_equivalent_sum_area,
		SUM(area_sqmi) filter (WHERE highed__lvl_2yr_equivalent >=1)             AS highed__lvl_2yr_equivalent_sum_area,
		SUM(area_sqmi) filter (WHERE highed__lvl_less_than_2yr >=1)             AS highed__lvl_less_than_2yr_sum_area,
		SUM(area_sqmi) filter (WHERE highed__lvl_4yr_500up >=1)             AS highed__lvl_4yr_500up_sum_area,
		SUM(area_sqmi) filter (WHERE highed__lvl_4yr_1000up >=1)            AS highed__lvl_4yr_1000up_sum_area,
		SUM(area_sqmi) filter (WHERE highed__lvl_4yr_2000up >=1)            AS highed__lvl_4yr_2000up_sum_area,
		SUM(area_sqmi) filter (WHERE highed__lvl_4yr_5000up >=1)            AS highed__lvl_4yr_5000up_sum_area,



		-- LODES 
		SUM(lodes_all_jobs_2017) AS lodes__all_jobs_2017,
		SUM(lodes_age_29_less_2017) AS lodes__age_29_less_2017,
		SUM(lodes_age_30_54_2017) AS lodes__age_30_54_2017,
		SUM(lodes_age_55_more_2017) AS lodes__age_55_more_2017,
		SUM(lodes_earn_1250_less_2017) AS lodes__earn_1250_less_2017,
		SUM(lodes_earn_1251_3333_2017) AS lodes__earn_1251_3333_2017,
		SUM(lodes_earn_3333_more_2017) AS lodes__earn_3333_more_2017,
		SUM(lodes_naics_11_2017) AS lodes__naics_11_2017,
		SUM(lodes_naics_21_2017) AS lodes__naics_21_2017,
		SUM(lodes_naics_22_2017) AS lodes__naics_22_2017,
		SUM(lodes_naics_23_2017) AS lodes__naics_23_2017,
		SUM(lodes_naics_31_33_2017) AS lodes__naics_31_33_2017,
		SUM(lodes_naics_42_2017) AS lodes__naics_42_2017,
		SUM(lodes_naics_44_45_2017) AS lodes__naics_44_45_2017,
		SUM(lodes_naics_48_49_2017) AS lodes__naics_48_49_2017,
		SUM(lodes_naics_51_2017) AS lodes__naics_51_2017,
		SUM(lodes_naics_52_2017) AS lodes__naics_52_2017,
		SUM(lodes_naics_53_2017) AS lodes__naics_53_2017,
		SUM(lodes_naics_54_2017) AS lodes__naics_54_2017,
		SUM(lodes_naics_55_2017) AS lodes__naics_55_2017,
		SUM(lodes_naics_56_2017) AS lodes__naics_56_2017,
		SUM(lodes_naics_61_2017) AS lodes__naics_61_2017,
		SUM(lodes_naics_62_2017) AS lodes__naics_62_2017,
		SUM(lodes_naics_71_2017) AS lodes__naics_71_2017,
		SUM(lodes_naics_72_2017) AS lodes__naics_72_2017,
		SUM(lodes_naics_81_2017) AS lodes__naics_81_2017,
		SUM(lodes_naics_92_2017) AS lodes__naics_92_2017,
		SUM(lodes_ed_highschool_less_2017) AS lodes__ed_highschool_less_2017,
		SUM(lodes_ed_highschool_eq_2017) AS lodes__ed_highschool_eq_2017,
		SUM(lodes_ed_associate_2017) AS lodes__ed_associate_2017,
		SUM(lodes_ed_bachelor_high_2017) AS lodes_ed_bachelor_high_2017,
		SUM(lodes_firm_age_0_1_2017) AS lodes__firm_age_0_1_2017,
		SUM(lodes_firm_age_2_3_2017) AS lodes__firm_age_2_3_2017,
		SUM(lodes_firm_age_4_5_2017) AS lodes__firm_age_4_5_2017,
		SUM(lodes_firm_age_6_10_2017) AS lodes__firm_age_6_10_2017,
		SUM(lodes_firm_age_11_more_2017) AS lodes__firm_age_11_more_2017,
		SUM(lodes_firm_size_0_19_2017) AS lodes__firm_size_0_19_2017,
		SUM(lodes_firm_size_20_49_2017) AS lodes__firm_size_20_49_2017,
		SUM(lodes_firm_size_50_249_2017) AS lodes__firm_size_50_249_2017,
		SUM(lodes_firm_size_250_499_2017) AS lodes__firm_size_250_499_2017,
		SUM(lodes_firm_size_500_more_2017) AS lodes__firm_size_500_more_2017,


		SUM(lodes_all_jobs_2012) AS lodes__all_jobs_2012,
		SUM(lodes_age_29_less_2012) AS lodes__age_29_less_2012,
		SUM(lodes_age_30_54_2012) AS lodes__age_30_54_2012,
		SUM(lodes_age_55_more_2012) AS lodes__age_55_more_2012,
		SUM(lodes_earn_1250_less_2012) AS lodes__earn_1250_less_2012,
		SUM(lodes_earn_1251_3333_2012) AS lodes__earn_1251_3333_2012,
		SUM(lodes_earn_3333_more_2012) AS lodes__earn_3333_more_2012,
		SUM(lodes_naics_11_2012) AS lodes__naics_11_2012,
		SUM(lodes_naics_21_2012) AS lodes__naics_21_2012,
		SUM(lodes_naics_22_2012) AS lodes__naics_22_2012,
		SUM(lodes_naics_23_2012) AS lodes__naics_23_2012,
		SUM(lodes_naics_31_33_2012) AS lodes__naics_31_33_2012,
		SUM(lodes_naics_42_2012) AS lodes__naics_42_2012,
		SUM(lodes_naics_44_45_2012) AS lodes__naics_44_45_2012,
		SUM(lodes_naics_48_49_2012) AS lodes__naics_48_49_2012,
		SUM(lodes_naics_51_2012) AS lodes__naics_51_2012,
		SUM(lodes_naics_52_2012) AS lodes__naics_52_2012,
		SUM(lodes_naics_53_2012) AS lodes__naics_53_2012,
		SUM(lodes_naics_54_2012) AS lodes__naics_54_2012,
		SUM(lodes_naics_55_2012) AS lodes__naics_55_2012,
		SUM(lodes_naics_56_2012) AS lodes__naics_56_2012,
		SUM(lodes_naics_61_2012) AS lodes__naics_61_2012,
		SUM(lodes_naics_62_2012) AS lodes__naics_62_2012,
		SUM(lodes_naics_71_2012) AS lodes__naics_71_2012,
		SUM(lodes_naics_72_2012) AS lodes__naics_72_2012,
		SUM(lodes_naics_81_2012) AS lodes__naics_81_2012,
		SUM(lodes_naics_92_2012) AS lodes__naics_92_2012,
		SUM(lodes_ed_highschool_less_2012) AS lodes__ed_highschool_less_2012,
		SUM(lodes_ed_highschool_eq_2012) AS lodes__ed_highschool_eq_2012,
		SUM(lodes_ed_associate_2012) AS lodes__ed_associate_2012,
		SUM(lodes_ed_bachelor_high_2012) AS lodes_ed_bachelor_high_2012,
		SUM(lodes_firm_age_0_1_2012) AS lodes__firm_age_0_1_2012,
		SUM(lodes_firm_age_2_3_2012) AS lodes__firm_age_2_3_2012,
		SUM(lodes_firm_age_4_5_2012) AS lodes__firm_age_4_5_2012,
		SUM(lodes_firm_age_6_10_2012) AS lodes__firm_age_6_10_2012,
		SUM(lodes_firm_age_11_more_2012) AS lodes__firm_age_11_more_2012,
		
		SUM(lodes_firm_size_0_19_2012) AS lodes__firm_size_0_19_2012,
		SUM(lodes_firm_size_20_49_2012) AS lodes__firm_size_20_49_2012,
		SUM(lodes_firm_size_50_249_2012) AS lodes__firm_size_50_249_2012,
		SUM(lodes_firm_size_250_499_2012) AS lodes__firm_size_250_499_2012,
		SUM(lodes_firm_size_500_more_2012) AS lodes__firm_size_500_more_2012,

		   -- Hospitals Summary
		COUNT(hosp__record_count)                                           AS hosp__record_count,
		COUNT(hosp__open_all)       filter (WHERE hosp__open_all > 0)       AS hosp__open_all_blcnt,
		COUNT(hosp__open_acute)     filter (WHERE hosp__open_acute > 0)     AS hosp__open_acute_blcnt,
		COUNT(hosp__open_cah)       filter (WHERE hosp__open_cah > 0)       AS hosp__open_cah_blcnt,
		COUNT(hosp__closed_all)     filter (WHERE hosp__closed_all > 0)     AS hosp__closed_all_blcnt,
		COUNT(hosp__closed_acute)     filter (WHERE hosp__closed_acute > 0) AS hosp__closed_acute_blcnt,
		COUNT(hosp__closed_cah)     filter (WHERE hosp__closed_cah > 0)     AS hosp__closed_cah_blcnt,
		

   -- FFRDC Summary
    COUNT(ffrdc__record_count)                                          AS ffrdc__record_count,
		COUNT(ffrdc__current)     filter (WHERE ffrdc__current > 0)         AS ffrdc__current_blcnt,
		COUNT(ffrdc__past)       filter (WHERE ffrdc__past > 0)             AS ffrdc__past_blcnt,

		
		-- F477 MAX UPLOAD SPEED
		MAX(f477_maxadup_2014dec)  AS f477_maxadup_2014dec_max,
		MAX(f477_maxadup_2018dec)  AS f477_maxadup_2018dec_max,
		MIN(f477_maxadup_2018dec) filter (WHERE f477_maxadup_2018dec> 0) AS f477_maxadup_2018dec_min,
		MAX(f477_maxadup_diff_14dec_18dec)  AS f477_maxadup_diff_14dec_18dec_max,
		MAX(f477_maxadup_all_fiber_2014dec)  AS f477_maxadup_all_fiber_2014dec_max,
		MAX(f477_maxadup_all_fiber_2018dec)  AS f477_maxadup_all_fiber_2018dec_max,
		MAX(f477_maxadup_all_fiber_diff_14dec_18dec)  AS f477_maxadup_all_fiber_diff_14dec_18dec_max,
		SUM(pop2018) filter (WHERE f477_maxadup_2014dec> 0)   AS f477_maxadup_2014dec_popsum,
		SUM(pop2018) filter (WHERE f477_maxadup_2018dec> 0)   AS f477_maxadup_2018dec_popsum,
		SUM(pop2018) filter (WHERE f477_maxadup_diff_14dec_18dec> 0)      AS f477_maxadup_diff__14dec_18dec_popsum,
		SUM(pop2018) filter (WHERE f477_maxadup_all_fiber_2014dec> 0)   AS f477_maxadup_all_fiber_2014dec_popsum,
    SUM(pop2018) filter (WHERE f477_maxadup_all_fiber_2018dec> 0)   AS f477_maxadup_all_fiber_2018dec_popsum,
		SUM(pop2018) filter (WHERE f477_maxadup_all_fiber_diff_14dec_18dec> 0)      AS f477_maxadup_all_fiber_diff_14dec_18dec_popsum,
		SUM(pop2018) filter (WHERE f477_maxadup_2018dec>= 3)     AS f477_maxadup_2018dec_3_popsum,
		SUM(pop2018) filter (WHERE f477_maxadup_2018dec>= 5)     AS f477_maxadup_2018dec_5_popsum,
		SUM(pop2018) filter (WHERE f477_maxadup_2018dec>= 10)    AS f477_maxadup_2018dec_10_popsum,
		SUM(pop2018) filter (WHERE f477_maxadup_2018dec>= 25)    AS f477_maxadup_2018dec_25_popsum,
		SUM(pop2018) filter (WHERE f477_maxadup_2018dec>= 50)    AS f477_maxadup_2018dec_50_popsum,
		SUM(pop2018) filter (WHERE f477_maxadup_2018dec>= 100)   AS f477_maxadup_2018dec_100_popsum,
		SUM(pop2018) filter (WHERE f477_maxadup_2018dec>= 200)   AS f477_maxadup_2018dec_200_popsum,
		SUM(pop2018) filter (WHERE f477_maxadup_2018dec>= 500)   AS f477_maxadup_2018dec_500_popsum,
		SUM(pop2018) filter (WHERE f477_maxadup_2018dec>= 999)   AS f477_maxadup_2018dec_999_popsum,
		
				-- F477 MAX Download SPEED
		MAX(f477_maxaddown_2014dec)  AS f477_maxaddown_2014dec_max,
		MAX(f477_maxaddown_2018dec)  AS f477_maxaddown_2018dec_max,
		MIN(f477_maxaddown_2018dec) filter (WHERE f477_maxaddown_2018dec> 0) AS f477_maxaddown_2018dec_min,
		MAX(f477_maxaddown_all_fiber_2014dec)  AS f477_maxaddown_all_fiber_2014dec_max,
		MAX(f477_maxaddown_all_fiber_2018dec)  AS f477_maxaddown_all_fiber_2018dec_max,
		SUM(pop2018) filter (WHERE f477_maxaddown_2014dec> 0)   AS f477_maxaddown_2014dec_popsum,
		SUM(pop2018) filter (WHERE f477_maxaddown_2018dec> 0)   AS f477_maxaddown_2018dec_popsum,
		SUM(pop2018) filter (WHERE f477_maxaddown_all_fiber_2014dec> 0)   AS f477_maxaddown_all_fiber_2014dec_popsum,
    SUM(pop2018) filter (WHERE f477_maxaddown_all_fiber_2018dec> 0)   AS f477_maxaddown_all_fiber_2018dec_popsum,
		SUM(pop2018) filter (WHERE f477_maxaddown_2018dec>= 5)     AS f477_maxaddown_2018dec_5_popsum,
		SUM(pop2018) filter (WHERE f477_maxaddown_2018dec>= 10)    AS f477_maxaddown_2018dec_10_popsum,
		SUM(pop2018) filter (WHERE f477_maxaddown_2018dec>= 25)    AS f477_maxaddown_2018dec_25_popsum,
		SUM(pop2018) filter (WHERE f477_maxaddown_2018dec>= 50)    AS f477_maxaddown_2018dec_50_popsum,
		SUM(pop2018) filter (WHERE f477_maxaddown_2018dec>= 100)   AS f477_maxaddown_2018dec_100_popsum,
		SUM(pop2018) filter (WHERE f477_maxaddown_2018dec>= 200)   AS f477_maxaddown_2018dec_200_popsum,
		SUM(pop2018) filter (WHERE f477_maxaddown_2018dec>= 500)   AS f477_maxaddown_2018dec_500_popsum,
		SUM(pop2018) filter (WHERE f477_maxaddown_2018dec>= 999)   AS f477_maxaddown_2018dec_999_popsum,
		SUM(pop2018) filter (WHERE f477_maxaddown_2018dec>= 25 AND f477_maxadup_2018dec>= 3)   AS f477_maxad_downup_2018dec_25_3_popsum,
		SUM(COALESCE(f477_maxaddown_2018dec, 0) * COALESCE(pop2018, 0)) AS f477_maxaddown_2018dec_pop_sum,
		SUM(COALESCE(f477_maxadup_2018dec, 0) * COALESCE(pop2018, 0)) AS f477_maxadup_2018dec_pop_sum
FROM     sch_analysis.la_base_blocks 
GROUP BY geoid_co;

ALTER TABLE sch_analysis.la_counties_broadband ADD CONSTRAINT la_counties__geoid_co_pk PRIMARY KEY (geoid_co);